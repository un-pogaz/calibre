#!/usr/bin/env python
# vim:fileencoding=utf-8

from calibre.web.feeds.news import BasicNewsRecipe


class Grani(BasicNewsRecipe):
    title = 'Грани.Ру'
    __author__ = 'bugmen00t'
    description = 'Ежедневная интернет-газета. Обзоры и анализ российских и мировых политических событий, статьи и видео о политических заключённых.'  # noqa
    publisher = 'ООО "Флавус"'
    category = 'newspaper'
    cover_url = 'https://graniru.org/files/96172.png'
    language = 'ru'
    no_stylesheets = False
    remove_javascript = False
    auto_cleanup = False
    remove_empty_feeds = True
    oldest_article = 30
    max_articles_per_feed = 50

    remove_tags_before = dict(name='h3')

    remove_tags_after = dict(name='div', attrs={'class': 'main-text clearfix'}),

    # Original feeds
    #    feeds = [
    #        ('Все материалы', 'https://graniru.org/export/all-atom.xml'),
    #        ('Статьи', 'https://graniru.org/export/articles-atom.xml')
    #        ]

    # Feeds from mirror site
    feeds = [
        (
            'Все материалы',
            'https://grani2.appspot.com/export/all-atom.xml'
        ),
        (
            'Статьи',
            'https://grani2.appspot.com/export/articles-atom.xml'
        ),
    ]

    # Mirror site feeds transformation
    def print_version(self, url):
        return url.replace('https://graniru.org/', 'https://grani2.appspot.com/')
