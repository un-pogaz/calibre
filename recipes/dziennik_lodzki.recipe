from calibre.web.feeds.news import BasicNewsRecipe


class DziennikLodzki(BasicNewsRecipe):
    title = 'Dziennik Ł\xf3dzki'
    __author__ = 'fenuks'
    description = 'Gazeta Regionalna Dziennik Łódzki. Najnowsze Wiadomości Łódź. Czytaj Wiadomości Łódzkie!'
    category = 'newspaper'
    language = 'pl'
    encoding = 'iso-8859-2'
    masthead_url = 'http://s.polskatimes.pl/g/logo_naglowek/dzienniklodzki.png?24'
    oldest_article = 7
    max_articles_per_feed = 100
    remove_empty_feeds = True
    no_stylesheets = True
    use_embedded_content = False
    ignore_duplicate_articles = {'title', 'url'}
    remove_tags_after = dict(attrs={'src': 'http://nm.dz.com.pl/dz.png'})
    remove_tags = [dict(id='mat-podobne'), dict(name='a', attrs={'class': 'czytajDalej'}), dict(attrs={
        'src': 'http://nm.dz.com.pl/dz.png'}), dict(name='a', attrs={'href': 'http://www.dzienniklodzki.pl/piano'})]

    feeds = [
    ('Na sygnale', 'http://www.dzienniklodzki.pl/rss/dzienniklodzki_nasygnale.xml?201302'),
    ('Ł\xf3dź', 'http://www.dzienniklodzki.pl/rss/dzienniklodzki_lodz.xml?201302'),
    ('Opinie', 'http://www.dzienniklodzki.pl/rss/dzienniklodzki_opinie.xml?201302'),
    ('Pieniądze', 'http://dzienniklodzki.feedsportal.com/c/32980/f/533763/index.rss?201302'),
    ('Kultura', 'http://dzienniklodzki.feedsportal.com/c/32980/f/533762/index.rss?201302'),
    ('Sport', 'http://dzienniklodzki.feedsportal.com/c/32980/f/533761/index.rss?201302'),
    ('Akcje', 'http://www.dzienniklodzki.pl/rss/dzienniklodzki_akcje.xml?201302'),
    ('M\xf3j Reporter', 'http://www.dzienniklodzki.pl/rss/dzienniklodzki_mojreporter.xml?201302'),
    ('Studni\xf3wki', 'http://www.dzienniklodzki.pl/rss/dzienniklodzki_studniowki.xml?201302'),
    ('Kraj', 'http://www.dzienniklodzki.pl/rss/dzienniklodzki_kraj.xml?201302'),
    ('Zdrowie', 'http://www.dzienniklodzki.pl/rss/dzienniklodzki_zdrowie.xml?201302')]

    def print_version(self, url):
        return url.replace('artykul', 'drukuj')

    def skip_ad_pages(self, soup):
        if 'Advertisement' in soup.title:
            nexturl = soup.find('a')['href']
            return self.index_to_soup(nexturl, raw=True)

    def get_cover_url(self):
        soup = self.index_to_soup(
            'http://www.prasa24.pl/gazeta/dziennik-lodzki/')
        self.cover_url = soup.find(id='pojemnik').img['src']
        return getattr(self, 'cover_url', self.cover_url)
